(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[583],{38122:function(e,r,o){Promise.resolve().then(o.bind(o,69919))},69919:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return $}});var i=o(57437),t=o(2265),a=o(24033),s=o(61865),l=o(38110),n=o(92160),c=o(98647),d=o(95294),u=o(61220),h=o(72753),p=o(66400),g=o(38504),m=o(34658),x=o(11328),y=o(87423),f=o(46940),b=o(8686),j=o(93471),v=o(21849),w=o(53410),S=o(86684),P=o(25515),U=o(84350),C=o(74571),I=o(95879),k=o(66955),F=o(66692),T=o(7172),z=o(72946),L=o(59070),A=o(32547),_=o(75825),R=o(1162),E=o(70953),B=o(63970),M=o(4035),H=o(82549),Z=o(31541),O=o(67972),V=o(96142),N=o(86264),D=o(37440);let J="https://hwrtgcuzgrajyzpxmjtz.supabase.co",W="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3cnRnY3V6Z3Jhanl6cHhtanR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwNjg5NTIsImV4cCI6MjA3MDY0NDk1Mn0.BTZ3lBbhfMzDJPt-fMokFIXTqtQPSj4WRsZAVeGu0Xg";if(!J||!W)throw Error("Missing Supabase environment variables. Please check your .env file.");let G=(0,D.eI)(J,W,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),Y=["image/jpeg","image/png","image/webp","image/gif"],q="profile-photos";class Q{validatePhotoFile(e){return e.size>5242880?{valid:!1,error:"File too large. Maximum size is ".concat(5,"MB")}:Y.includes(e.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Allowed types: ".concat(Y.join(", "))}}async validatePhotoFileAsync(e){let r=this.validatePhotoFile(e);return r.valid?new Promise(r=>{let o=new FileReader;o.onload=e=>{var o;let i=Array.from(new Uint8Array(null===(o=e.target)||void 0===o?void 0:o.result).slice(0,4)).map(e=>e.toString(16).padStart(2,"0")).join("");Object.keys({ffd8ffe0:"JPEG",ffd8ffe1:"JPEG",ffd8ffe2:"JPEG","89504e47":"PNG",47494638:"GIF",52494646:"WEBP"}).some(e=>i.startsWith(e.toLowerCase()))?r({valid:!0}):r({valid:!1,error:"File does not appear to be a valid image"})},o.onerror=()=>r({valid:!1,error:"Could not read file for validation"}),o.readAsArrayBuffer(e.slice(0,4))}):r}generateFilePath(e,r){var o;let i=Date.now(),t=Math.random().toString(36).substring(2,15),a=(null===(o=r.split(".").pop())||void 0===o?void 0:o.toLowerCase())||"jpg";return"".concat(e,"/").concat(i,"_").concat(t,".").concat(a)}async uploadPhoto(e,r,o){try{null==o||o({progress:10,stage:"validating"});let i=await this.validatePhotoFileAsync(e);if(!i.valid)return{success:!1,error:i.error};let t=this.generateFilePath(r,e.name);null==o||o({progress:30,stage:"uploading"});let{data:a,error:s}=await this.supabase.storage.from(q).upload(t,e,{cacheControl:"3600",upsert:!1});if(s)return console.error("Storage upload error:",s),{success:!1,error:"Upload failed: ".concat(s.message)};null==o||o({progress:80,stage:"processing"});let{data:l}=this.supabase.storage.from(q).getPublicUrl(t);if(!(null==l?void 0:l.publicUrl))return{success:!1,error:"Failed to generate photo URL"};return null==o||o({progress:100,stage:"complete"}),{success:!0,photoUrl:l.publicUrl}}catch(e){return console.error("Photo upload error:",e),{success:!1,error:e instanceof Error?e.message:"Upload failed"}}}async deletePhoto(e,r){try{let o=new URL(e).pathname.split("/").slice(-2).join("/");if(!o.startsWith(r+"/"))return console.error("Unauthorized photo deletion attempt"),!1;let{error:i}=await this.supabase.storage.from(q).remove([o]);if(i)return console.error("Photo deletion error:",i),!1;return!0}catch(e){return console.error("Photo deletion error:",e),!1}}async createSignedUploadUrl(e,r,o,i){try{if(o>5242880)return{error:"File too large. Maximum size is ".concat(5,"MB")};if(!Y.includes(i))return{error:"Invalid file type. Allowed types: ".concat(Y.join(", "))};let t=this.generateFilePath(e,r),{data:a,error:s}=await this.supabase.storage.from(q).createSignedUploadUrl(t);if(s)return{error:"Failed to create upload URL: ".concat(s.message)};let{data:l}=this.supabase.storage.from(q).getPublicUrl(t);return{uploadUrl:a.signedUrl,finalUrl:l.publicUrl}}catch(e){return{error:e instanceof Error?e.message:"Failed to create upload URL"}}}async uploadWithSignedUrl(e,r,o){try{null==o||o({progress:10,stage:"validating"});let i=await this.validatePhotoFileAsync(e);if(!i.valid)return{success:!1,error:i.error};null==o||o({progress:30,stage:"uploading"});let t=await fetch(r,{method:"PUT",body:e,headers:{"Content-Type":e.type}});if(!t.ok)return{success:!1,error:"Upload failed with status: ".concat(t.status)};return null==o||o({progress:100,stage:"complete"}),{success:!0,photoUrl:r.split("?")[0]}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Upload failed"}}}async compressImage(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(i=>{let t=document.createElement("canvas"),a=t.getContext("2d"),s=new Image;s.onload=()=>{let{width:l,height:n}=s,c=l/n;t.width=Math.min(l,r),t.height=t.width/c,a.drawImage(s,0,0,t.width,t.height),t.toBlob(r=>{r?i(new File([r],e.name,{type:e.type,lastModified:Date.now()})):i(e)},e.type,o)},s.onerror=()=>i(e),s.src=URL.createObjectURL(e)})}constructor(){this.supabase=G}}let X=new Q,K=n.Ry({bio:n.Z_().min(10,"Bio must be at least 10 characters").max(400,"Bio must be 400 characters or less").refine(e=>!/(\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4})/.test(e)&&!/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/.test(e),"Please don't include phone numbers or email addresses in your bio"),location:n.Ry({lat:n.Rx().min(-90).max(90).optional(),lng:n.Rx().min(-180).max(180).optional(),city:n.Z_().optional(),privacy_mode:n.Km(["precise","city_only"])}).refine(e=>void 0!==e.lat&&void 0!==e.lng||e.city,"Either precise location or city name is required"),travel_radius:n.Rx().min(1).max(50),photo_file:n.Pp(File).optional()});function $(){let e=(0,a.useRouter)(),r=(0,d.useToast)(),{control:o,handleSubmit:n,formState:{errors:D,isSubmitting:J,isValid:W},setValue:G,watch:Y,trigger:q}=(0,s.cI)({resolver:(0,l.F)(K),defaultValues:{bio:"",location:{privacy_mode:"precise"},travel_radius:20},mode:"onChange"}),Q=Y("bio"),$=Y("location.privacy_mode");Y("travel_radius");let[ee,er]=(0,t.useState)({isLoading:!1,error:null,hasPermission:null,coordinates:null,city:""}),[eo,ei]=(0,t.useState)({isUploading:!1,progress:0,stage:"",error:null,photoUrl:null,previewUrl:null}),et=(null==Q?void 0:Q.length)||0,ea=et/400*100,es=(0,t.useCallback)(async()=>{if(!navigator.geolocation){er(e=>({...e,error:"Geolocation is not supported by this browser",hasPermission:!1}));return}er(e=>({...e,isLoading:!0,error:null}));try{let{latitude:e,longitude:r}=(await new Promise((e,r)=>{navigator.geolocation.getCurrentPosition(e,r,{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5})})).coords;er(o=>({...o,isLoading:!1,hasPermission:!0,coordinates:{lat:e,lng:r}})),G("location.lat",e),G("location.lng",r);try{await el(e,r)}catch(e){console.warn("Reverse geocoding failed:",e)}await q("location")}catch(r){let e="Unable to get your location";if(r.code)switch(r.code){case r.PERMISSION_DENIED:e="Location access denied. You can still enter your city manually.";break;case r.POSITION_UNAVAILABLE:e="Location information unavailable. Please enter your city manually.";break;case r.TIMEOUT:e="Location request timed out. Please try again or enter your city manually."}er(r=>({...r,isLoading:!1,error:e,hasPermission:!1}))}},[G,q]),el=async(e,r)=>{try{let o=await fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e,"&longitude=").concat(r,"&localityLanguage=en"));if(o.ok){let e=await o.json(),r=e.city||e.locality||e.principalSubdivision||"";r&&(er(e=>({...e,city:r})),G("location.city",r),await q("location"))}}catch(e){console.warn("Reverse geocoding failed:",e)}},en=(0,t.useCallback)(async e=>{let o=e[0];if(!o)return;let i=X.validatePhotoFile(o);if(!i.valid){ei(e=>({...e,error:i.error||"Invalid file"}));return}let t=URL.createObjectURL(o);ei(e=>({...e,previewUrl:t,error:null,isUploading:!0,progress:0}));try{let e=await X.uploadPhoto(o,"demo-user-id",e=>{ei(r=>({...r,progress:e.progress,stage:e.stage}))});if(e.success&&e.photoUrl)ei(r=>({...r,isUploading:!1,photoUrl:e.photoUrl||null,progress:100,stage:"complete"})),G("photo_file",o),await q("photo_file"),r({title:"Photo uploaded successfully",status:"success",duration:3e3});else throw Error(e.error||"Upload failed")}catch(e){ei(r=>({...r,isUploading:!1,error:e instanceof Error?e.message:"Upload failed"})),r({title:"Photo upload failed",description:e instanceof Error?e.message:"Please try again",status:"error",duration:5e3})}},[G,q,r]),ec=(0,t.useCallback)(()=>{eo.previewUrl&&URL.revokeObjectURL(eo.previewUrl),ei({isUploading:!1,progress:0,stage:"",error:null,photoUrl:null,previewUrl:null}),G("photo_file",void 0)},[eo.previewUrl,G]),{getRootProps:ed,getInputProps:eu,isDragActive:eh}=(0,c.uI)({onDrop:en,accept:{"image/*":[".jpeg",".jpg",".png",".webp",".gif"]},maxSize:5242880,multiple:!1,disabled:eo.isUploading}),ep=async o=>{try{let i={user_id:"demo-user-id",bio:o.bio,location:{lat:o.location.lat,lng:o.location.lng,city:o.location.city||ee.city,privacy_mode:o.location.privacy_mode},travel_radius:o.travel_radius,photo_url:eo.photoUrl},t=await fetch("/api/profile/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.detail||"HTTP ".concat(t.status))}let a=await t.json();if(a.success)r({title:"Profile completed successfully!",description:"You're ready to find your wingman buddy",status:"success",duration:4e3}),e.push("/find-buddy");else throw Error(a.message||"Profile completion failed")}catch(e){console.error("Profile submission error:",e),r({title:"Profile submission failed",description:e instanceof Error?e.message:"Please try again",status:"error",duration:5e3})}};return(0,i.jsxs)(u.Box,{minH:"100vh",bg:"brand.50",children:[(0,i.jsx)(u.Box,{borderBottom:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(h.Container,{maxW:"4xl",py:6,px:4,children:(0,i.jsxs)(p.VStack,{spacing:4,textAlign:"center",children:[(0,i.jsx)(g.Heading,{as:"h1",size:"xl",fontFamily:"heading",color:"brand.900",children:"Complete Your Profile"}),(0,i.jsx)(m.Text,{color:"gray.600",fontSize:"lg",children:"Tell us about yourself and set your preferences"})]})})}),(0,i.jsx)(h.Container,{maxW:"4xl",py:8,px:4,children:(0,i.jsx)("form",{onSubmit:n(ep),children:(0,i.jsxs)(p.VStack,{spacing:8,align:"stretch",children:[(0,i.jsx)(x.Card,{children:(0,i.jsx)(y.CardBody,{p:8,children:(0,i.jsxs)(p.VStack,{spacing:6,align:"stretch",children:[(0,i.jsxs)(f.HStack,{children:[(0,i.jsx)(b.Icon,{as:M.Z,color:"brand.400"}),(0,i.jsx)(g.Heading,{as:"h2",size:"md",color:"brand.900",children:"Profile Photo"}),(0,i.jsx)(j.Badge,{colorScheme:"gray",variant:"subtle",children:"Optional"})]}),eo.previewUrl?(0,i.jsxs)(p.VStack,{spacing:4,children:[(0,i.jsxs)(u.Box,{position:"relative",children:[(0,i.jsx)(v.Image,{src:eo.previewUrl,alt:"Profile preview",borderRadius:"lg",maxH:"200px",maxW:"200px",objectFit:"cover"}),(0,i.jsx)(w.Button,{position:"absolute",top:2,right:2,size:"sm",colorScheme:"red",variant:"solid",onClick:ec,isDisabled:eo.isUploading,children:(0,i.jsx)(b.Icon,{as:H.Z})})]}),eo.isUploading&&(0,i.jsxs)(p.VStack,{spacing:2,children:[(0,i.jsx)(S.CircularProgress,{value:eo.progress,color:"brand.400",size:"60px",children:(0,i.jsxs)(P.CircularProgressLabel,{fontSize:"sm",children:[Math.round(eo.progress),"%"]})}),(0,i.jsxs)(m.Text,{fontSize:"sm",color:"gray.600",textTransform:"capitalize",children:[eo.stage,"..."]})]})]}):(0,i.jsxs)(u.Box,{...ed(),borderWidth:"2px",borderStyle:"dashed",borderColor:eh?"brand.400":"gray.200",borderRadius:"lg",p:8,textAlign:"center",cursor:"pointer",bg:eh?"brand.50":"white",transition:"all 0.2s",_hover:{borderColor:"brand.400",bg:"brand.50"},children:[(0,i.jsx)("input",{...eu()}),(0,i.jsxs)(p.VStack,{spacing:4,children:[(0,i.jsx)(b.Icon,{as:Z.Z,size:32,color:"brand.400"}),(0,i.jsxs)(p.VStack,{spacing:2,children:[(0,i.jsx)(m.Text,{fontWeight:"medium",color:"brand.900",children:eh?"Drop your photo here":"Upload a profile photo"}),(0,i.jsx)(m.Text,{fontSize:"sm",color:"gray.600",children:"Drag and drop or click to browse"}),(0,i.jsx)(m.Text,{fontSize:"xs",color:"gray.500",children:"JPEG, PNG, WebP, GIF • Max 5MB"})]})]})]}),eo.error&&(0,i.jsxs)(U.Alert,{status:"error",borderRadius:"md",children:[(0,i.jsx)(C.AlertIcon,{}),(0,i.jsx)(I.AlertTitle,{fontSize:"sm",children:"Upload Error:"}),(0,i.jsx)(k.AlertDescription,{fontSize:"sm",children:eo.error})]})]})})}),(0,i.jsx)(x.Card,{children:(0,i.jsx)(y.CardBody,{p:8,children:(0,i.jsxs)(p.VStack,{spacing:6,align:"stretch",children:[(0,i.jsxs)(f.HStack,{children:[(0,i.jsx)(b.Icon,{as:O.Z,color:"brand.400"}),(0,i.jsx)(g.Heading,{as:"h2",size:"md",color:"brand.900",children:"About You"}),(0,i.jsx)(j.Badge,{colorScheme:"red",variant:"solid",children:"Required"})]}),(0,i.jsx)(s.Qr,{name:"bio",control:o,render:e=>{var r;let{field:o}=e;return(0,i.jsxs)(F.FormControl,{isInvalid:!!D.bio,children:[(0,i.jsx)(T.FormLabel,{children:"Tell us about yourself"}),(0,i.jsx)(z.Textarea,{...o,placeholder:"Share what makes you unique, your interests, what you're looking for in a wingman buddy...",rows:4,resize:"vertical",bg:"white"}),(0,i.jsxs)(L.Flex,{justify:"space-between",align:"center",mt:2,children:[(0,i.jsx)(A.FormErrorMessage,{children:null===(r=D.bio)||void 0===r?void 0:r.message}),(0,i.jsxs)(f.HStack,{spacing:2,children:[(0,i.jsx)(_.Progress,{value:ea,size:"sm",w:"100px",colorScheme:ea>90?"red":"brand"}),(0,i.jsxs)(m.Text,{fontSize:"sm",color:ea>90?"red.500":"gray.600",children:[et,"/400"]})]})]}),!D.bio&&(0,i.jsx)(F.FormHelperText,{children:"Minimum 10 characters. Avoid including personal contact information."})]})}})]})})}),(0,i.jsx)(x.Card,{children:(0,i.jsx)(y.CardBody,{p:8,children:(0,i.jsxs)(p.VStack,{spacing:6,align:"stretch",children:[(0,i.jsxs)(f.HStack,{children:[(0,i.jsx)(b.Icon,{as:V.Z,color:"brand.400"}),(0,i.jsx)(g.Heading,{as:"h2",size:"md",color:"brand.900",children:"Location & Preferences"}),(0,i.jsx)(j.Badge,{colorScheme:"red",variant:"solid",children:"Required"})]}),(0,i.jsx)(s.Qr,{name:"location.privacy_mode",control:o,render:e=>{let{field:r}=e;return(0,i.jsxs)(F.FormControl,{children:[(0,i.jsx)(T.FormLabel,{children:"Location Privacy"}),(0,i.jsxs)(f.HStack,{children:[(0,i.jsx)(R.Switch,{isChecked:"precise"===r.value,onChange:e=>r.onChange(e.target.checked?"precise":"city_only"),colorScheme:"brand"}),(0,i.jsx)(m.Text,{children:"precise"===r.value?"Share exact location":"City only"})]}),(0,i.jsx)(F.FormHelperText,{children:"precise"===r.value?"Your precise coordinates will be used for matching within your travel radius":"Only your city will be shared, using city center for distance calculations"})]})}}),"precise"===$?(0,i.jsxs)(p.VStack,{spacing:4,align:"stretch",children:[(0,i.jsx)(w.Button,{onClick:es,isLoading:ee.isLoading,loadingText:"Getting location...",leftIcon:(0,i.jsx)(b.Icon,{as:V.Z}),variant:"outline",borderColor:"brand.400",color:"brand.900",_hover:{bg:"brand.100"},disabled:!0===ee.hasPermission,children:!0===ee.hasPermission?"Location captured".concat(ee.city?" • ".concat(ee.city):""):"Use My Current Location"}),ee.error&&(0,i.jsxs)(U.Alert,{status:"warning",borderRadius:"md",children:[(0,i.jsx)(C.AlertIcon,{}),(0,i.jsx)(k.AlertDescription,{fontSize:"sm",children:ee.error})]}),!0===ee.hasPermission&&(0,i.jsxs)(U.Alert,{status:"success",borderRadius:"md",children:[(0,i.jsx)(C.AlertIcon,{}),(0,i.jsxs)(k.AlertDescription,{fontSize:"sm",children:["Location captured successfully!",ee.city&&" Detected city: ".concat(ee.city)]})]})]}):(0,i.jsx)(s.Qr,{name:"location.city",control:o,render:e=>{var r;let{field:o}=e;return(0,i.jsxs)(F.FormControl,{isInvalid:!!D.location,children:[(0,i.jsx)(T.FormLabel,{children:"City"}),(0,i.jsx)(E.Input,{...o,placeholder:"Enter your city (e.g., San Francisco, CA)",bg:"white"}),(0,i.jsx)(A.FormErrorMessage,{children:null===(r=D.location)||void 0===r?void 0:r.message}),(0,i.jsx)(F.FormHelperText,{children:"We'll use your city center for distance calculations"})]})}}),(0,i.jsx)(s.Qr,{name:"travel_radius",control:o,render:e=>{let{field:r}=e;return(0,i.jsxs)(F.FormControl,{children:[(0,i.jsxs)(T.FormLabel,{children:["Travel Radius: ",r.value," miles"]}),(0,i.jsxs)(B.Slider,{...r,min:1,max:50,step:1,colorScheme:"brand",children:[(0,i.jsx)(B.SliderTrack,{children:(0,i.jsx)(B.SliderFilledTrack,{})}),(0,i.jsx)(B.SliderThumb,{})]}),(0,i.jsx)(F.FormHelperText,{children:"Maximum distance you're willing to travel to meet your wingman buddy"})]})}})]})})}),(0,i.jsx)(x.Card,{children:(0,i.jsx)(y.CardBody,{p:8,children:(0,i.jsxs)(p.VStack,{spacing:4,children:[(0,i.jsx)(w.Button,{type:"submit",size:"lg",colorScheme:"brand",bg:"brand.900",color:"brand.50",_hover:{bg:"gray.600"},isLoading:J,loadingText:"Completing profile...",disabled:!W||eo.isUploading,w:"full",maxW:"300px",children:J?(0,i.jsxs)(f.HStack,{children:[(0,i.jsx)(N.Z,{size:16}),(0,i.jsx)(m.Text,{children:"Completing Profile..."})]}):"Complete Profile"}),(0,i.jsx)(m.Text,{fontSize:"sm",color:"gray.600",textAlign:"center",children:"By completing your profile, you'll be ready to find and connect with wingman buddies"})]})})})]})})})]})}}},function(e){e.O(0,[873,593,562,82,851,971,938,744],function(){return e(e.s=38122)}),_N_E=e.O()}]);